---
title: "Shiny<br>Visualizacion de datos con R<br>Slides 4"
subtitle: "Diplomado en Data Science, MatPUC"
author: "Joshua Kunst Fuentes jbkunst@gmail.com https://jkunst.com/blog/"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "metropolis", "metropolis-fonts", "assets/custom.css"]
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
source("R/setup-xaringan.R")
```


```{r, child="readme.md"}
```

---

# Ejercicio: Revisar applicaci贸n

Revise la aplicaci贸n del ejercicio "inputs + laytous + htmlwidgets" que utilizaba la funci贸n `descargar_data`.

- Que sucede en cada bloque `render`?
- Que pasa si tuviera m谩s outputs (y por tanto renders) que utilicen estos datos?
- Modifique la funci贸n `descargar_data` agregnado al inicio del cuerpo de la funcion `Sys.sleep(5)` y pruebe la aplicaci贸n con esta modificaci贸n.


---

class: center, middle, inverse

# Expresiones reactivas

---

# Expresiones reactivas (_reactive expressions_)


.pull-left[
La idea de expresiones reactiva es que podemos limitar que es lo que se (re)ejecuta al cambiar un input.

Una expresi贸n reactiva es c贸digo R que usa un input y retorna un valor, 
la expresion se actualizar谩 cuando el valor del (de los) inputs de los cuales dependen
cambien.

Estos elementos se definen en el `server`. Se crea una expresion con la funci贸n `reactive` la que toma una expresi贸n/c贸digo R entre `{}`, de la misma forma que las funciones `render` (`renderPlot`, `renderTable`):

```
server <- function(input, output) {
  ...
  elementoReactivo <- reactive({
    codigo R...
  })
  ...

} 
```

]

.pull-right[
```r
server <- function(input, output) {
  
  dataSismos <- reactive({
    fecha <- ymd(input$fecha)
    ...
    datos <- read_html(url) |>
      html_table() |> ...
    datos
    
  })
  
  output$mapa <- renderLeaflet({
    
    datos <- dataSismos()
    
    leaflet(datos) |> ...
  })
  
  output$tabla <- renderDT({
    datatable(dataSismos())
  })
  
})
```
]

---

# Expresiones reactivas: Ejemplo

.center[
![](imgs/reactivity1.png)
]

---

# Expresiones reactivas: Ejemplo _mejorado_

.center[
![](imgs/reactivity2.png)
]

---

# Ejercicio: Creando una expresi贸n reactiva

Para el ejercicio "inputs + laytous + htmlwidgets":

- Cree la expresi贸n reactiva necesaria para reducir la cantidad de descargas.

- Se puede mejorar? (`bindCache`)

---

class: center, middle, inverse

# Orden de ejecuci贸n

---

# Una vez 

.center[
```{r echo = FALSE, out.width = "70%" }
knitr::include_graphics("imgs/run-once.png")
```
]

---

# Una vez por usuario

.center[
```{r echo = FALSE, out.width = "70%" }
knitr::include_graphics("imgs/run-once-per-user.png")
```
]

---

# Muchas veces

.center[
```{r echo = FALSE, out.width = "70%" }
knitr::include_graphics("imgs/run-many-times.png")
```
]

---

class: center, middle, inverse

# Extensiones para Shiny

---

# Extensiones para Shiny

Podemos decir que ya existe un _shinyverso_ dada la cantidad de paquetes
que extienden shiny, agregando tanto dise帽os, nuevas funcionalidades, etc:

https://github.com/nanxstats/awesome-shiny-extensions

Menciones honrosas (_en mi opini贸n_):

- https://waiter.john-coene.com/

- https://cicerone.john-coene.com/

Buen ejercicio es incorporar las funcionalidades de {waiter} y {ciceroene} en la aplicaci贸n.

---

# Cosas que no vimos ... Pero que existen! 

... Que ni tan necesarias, pero que en futuro podr铆an ayudar!


- `bindCache`: Se puede asociar un resultado de un `render` a ciertos inputs, para guardar autom谩ticament el resultado sin tener que volver a ejecutar el c贸digo dentro del `render`. 
https://shiny.rstudio.com/articles/caching.html

- Bookmarking: La posibilidad de registrar la aplicaci贸n con ciertos inputs seleccionados.
Como cuando comparter una aplicaci贸n de un retail con ciertos filtros. https://mastering-shiny.org/action-bookmark.html

- HTMLWidgets Proxys: Caracter铆sticas de algunos HTMLWidgets para no _recontruir_ el gr谩fico sino que actualizarlo. https://jbkunst.shinyapps.io/bias-variance/ 
